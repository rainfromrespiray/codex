<!-- Dual Pack with Tabbed Interface - Matching Triple Pack Styling + Spinner Fix + Rotating Text -->

<!-- CSS Styles - Self-contained within this widget -->
<style>
.dual-tab-button {
  line-height: 1.4;
}
.dual-product-tabs-nav {
  display: flex;
  margin: 0 -33px 10px -33px;
  border: none;
}
.dual-tab-button {
  flex: 1;
  background: #F2F2F2;
  border: none;
  padding: 2px;
  font-size: 14px;
  cursor: pointer;
  text-align: center;
  color: #333;
  font-weight: normal;
  transition: all 0.2s ease;
  position: relative;
  border-right: 1px solid #fff;
}
.dual-tab-button:last-child {
  border-right: none;
}
.dual-tab-button.active-tab {
  background-color: #D6EFFF;
  color: #333;
  font-weight: normal;
}
.dual-tab-button[data-tab="dual1"].active-tab {
  border-top: 1px solid #199ACE;
  border-right: 1px solid #199ACE;
  border-bottom: 1px solid #199ACE;
  border-left: none;
}
.dual-tab-button[data-tab="dual2"].active-tab {
  border-top: 1px solid #199ACE;
  border-bottom: 1px solid #199ACE;
  border-left: 1px solid #199ACE;
  border-right: none;
}
.dp-selector-container {
  text-align: center;
  padding: 0px 0;
  margin-bottom: 0px;
}
.dp-choose-color {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 5px;
}
.dp-circles {
  display: flex;
  justify-content: center;
  margin-bottom: 0px;
}
.dp-circle {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  position: relative;
  cursor: pointer;
  box-sizing: border-box;
}
.dp-black {
  background-color: black;
  border: 2px solid white;
  outline: 1px solid #ccc;
  margin-right: 20px;
}
.dp-white {
  background-color: white;
  border: 1px solid #ccc;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
}
.dp-white .inner-circle {
  width: 29px;
  height: 29px;
  border: 1px solid #ccc;
  border-radius: 50%;
  position: absolute;
}
.dp-black.dp-selected {
  outline: 1px solid #199ACE;
}
.dp-white.dp-selected:before {
  content: "";
  position: absolute;
  top: -1px;
  left: -1px;
  right: -1px;
  bottom: -1px;
  border: 1px solid #199ACE;
  border-radius: 50%;
  z-index: 1;
}
.dp-black.dp-selected:before {
  display: none;
}
.dp-black.dp-selected:after {
  content: "";
  position: absolute;
  width: 8px;
  height: 8px;
  background-color: #199ACE;
  border-radius: 50%;
  top: -3px;
  right: -3px;
  z-index: 2;
}
.dp-white.dp-selected .selection-dot {
  position: absolute;
  width: 8px;
  height: 8px;
  background-color: #199ACE;
  border-radius: 50%;
  top: -1px;
  right: -1px;
  z-index: 2;
}
.dp-labels {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 5px;
}
.dp-label {
  width: 35px;
  font-size: 12px;
  color: black;
  text-align: center;
}
.dp-label-black {
  margin-right: 20px;
}
.dual-tab-content {
  display: none;
}
.dual-tab-content.active {
  display: block;
}
@keyframes glow {
  0% { box-shadow: 0 0 5px rgba(242, 34, 34, 0.6); }
  50% { box-shadow: 0 0 15px rgba(242, 34, 34, 0.8); }
  100% { box-shadow: 0 0 5px rgba(242, 34, 34, 0.6); }
}
.add-to-cart-ajax.dual_pack {
  background: #F22222;
  color: white;
  border: none;
  width: 100%;
  height: auto;
  border-radius: 30px;
  font-family: "Retail Font", Arial, sans-serif;
  font-size: 16px;
  font-style: normal;
  font-weight: 400;
  line-height: 24px;
  padding: 10px;
  animation: glow 1.5s infinite;
  cursor: pointer;
  margin: 0 0 15px;
  text-transform: none;
}
.loading-spinner {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid #fff;
  border-top: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
  margin-left: 10px;
  vertical-align: text-bottom;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>

<div class="dual-product-tabs-nav">
  <button class="dual-tab-button active-tab" data-tab="dual1">Device 1<br>color</button>
  <button class="dual-tab-button" data-tab="dual2">Device 2<br>color</button>
</div>

<div class="dual-tabs-content">
  <div class="dual-tab-content active" id="dual1">
    <div class="dp-selector-container">
      <div class="dp-choose-color">
        <div class="dp-circles">
          <div class="dp-circle dp-black dp-selected" id="dp_p1_black"></div>
          <div class="dp-circle dp-white" id="dp_p1_white">
            <div class="inner-circle"></div>
            <div class="selection-dot"></div>
          </div>
        </div>
        <div class="dp-labels">
          <span class="dp-label dp-label-black">Black</span>
          <span class="dp-label dp-label-white">White</span>
        </div>
      </div>
    </div>
  </div>
  <div class="dual-tab-content" id="dual2">
    <div class="dp-selector-container">
      <div class="dp-choose-color">
        <div class="dp-circles">
          <div class="dp-circle dp-black" id="dp_p2_black"></div>
          <div class="dp-circle dp-white dp-selected" id="dp_p2_white">
            <div class="inner-circle"></div>
            <div class="selection-dot"></div>
          </div>
        </div>
        <div class="dp-labels">
          <span class="dp-label dp-label-black">Black</span>
          <span class="dp-label dp-label-white">White</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="dual-product-image-container" style="position: relative; margin-bottom: 15px; width: 100%; text-align: center;">
  <img id="dual_black_black" class="dual_pack_img" src="https://respiray.com/wp-content/uploads/2023/01/dual-black-black.jpg" alt="Dual Pack - All Black" style="display:block; max-width:100%; height:auto;">
  <img id="dual_white_white" class="dual_pack_img" src="https://respiray.com/wp-content/uploads/2023/01/dual-white-white.jpg" alt="Dual Pack - All White" style="display:none; max-width:100%; height:auto;">
  <img id="dual_black_white" class="dual_pack_img" src="https://respiray.com/wp-content/uploads/2023/01/dual-black-white.jpg" alt="Dual Pack - Mixed" style="display:none; max-width:100%; height:auto;">
  <img id="dual_white_black" class="dual_pack_img" src="https://respiray.com/wp-content/uploads/2023/01/dual-white-black.jpg" alt="Dual Pack - Mixed" style="display:none; max-width:100%; height:auto;">
</div>

<button id="dual-pack-btn" class="add-to-cart-ajax dual_pack">
  <span class="status-text">Claim now</span>
</button>

<script>
jQuery(function($){
  var dualColors = { p1:'black', p2:'white' };

  // tabs
  $('.dual-tab-button').click(function(){
    $('.dual-tab-button').removeClass('active-tab');
    $(this).addClass('active-tab');
    $('.dual-tab-content').removeClass('active');
    $('#' + $(this).data('tab')).addClass('active');
  });

  // pickers
  $('#dp_p1_black,#dp_p1_white').click(function(){
    $('#dp_p1_black,#dp_p1_white').removeClass('dp-selected');
    $(this).addClass('dp-selected');
    dualColors.p1 = $(this).hasClass('dp-white')?'white':'black';
    updateDualImage();
  });
  $('#dp_p2_black,#dp_p2_white').click(function(){
    $('#dp_p2_black,#dp_p2_white').removeClass('dp-selected');
    $(this).addClass('dp-selected');
    dualColors.p2 = $(this).hasClass('dp-white')?'white':'black';
    updateDualImage();
  });

  function updateDualImage(){
    var combo = dualColors.p1+'_'+dualColors.p2;
    $('.dual_pack_img').hide();
    $('#dual_'+combo).show();
  }
  updateDualImage();

  // spinner helpers (same as offer 3)
  function showSpinner($btn){
    const msgs=['Loading','Hang tight','Almost there'], L=msgs.length;
    let i=0;
    $btn.addClass('loading').prop('disabled',true)
        .html('<span class="status-text">'+msgs[0]+'</span><span class="loading-spinner"></span>');
    var iv=setInterval(function(){
      i=(i+1)%L;
      $btn.find('.status-text').text(msgs[i]);
    },2500);
    $btn.data('spinner-iv',iv);
  }
  function hideSpinner($btn){
    clearInterval($btn.data('spinner-iv'));
    $btn.removeClass('loading').prop('disabled',false)
        .html('<span class="status-text">Claim now</span>');
  }

  // bind
  $('#dual-pack-btn')
    .off('click')
    .on('click',function(e){
      e.preventDefault(); e.stopImmediatePropagation();
      var $btn=$(this);
      showSpinner($btn);
      var combo = dualColors.p1[0]+dualColors.p2[0];

      fetch(window.location.origin + '/wp-json/nf/v1/bundle', {
        method:'POST',
        credentials:'include',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({combo})
      })
      .then(r=>{ if(!r.ok) throw 'Status '+r.status; return r.json(); })
      .then(json=>{
        if(json.success){
          window.location.href='/checkouts/nf/';
        } else throw 'bundle error';
      })
      .catch(err=>{
        console.error(err);
        alert('Something went wrong. Please refresh and try again.');
        hideSpinner($btn);
      });
    });
});
</script>
